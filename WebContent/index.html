<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--<link rel="stylesheet" type="text/css" href="./css/bootstrap/bootstrap.css">-->
    <link rel="stylesheet" href="./css/main.css"/>
</head>
<body>
    <div>
        <h1>WFAAgent WebClient Use SuperSocket</h1>
    </div>
    <div>
        <div>
            <span id="wsStatus">연결상태 : </span>
        </div>
        
        <div>
            <button type="button" class="btn btn-primary" onclick="wsConnect()">
                웹 소켓 연결
            </button>                
        </div>
    </div>
    
    <div>
        <div class="process">
            <div>
                <h3>클라이언트 요청</h3>
            </div>
            <textarea id="wsExecuteFileName" cols="100" rows="10">C:\\Workspace\\GitProject\\WFAAgent\\TestClientNet45\\bin\\Debug\\TestClientNet45.exe</textarea>
            <div>
                <button type="button" onclick="wsProcessStart()">
                    프로세스 실행
                </button>
            </div>

            <textarea id="eventData" cols="100" rows="10"></textarea>

            <div>
                <label>이벤트 데이터 이름 : <input type="text" id="eventDataName"/></label>
                <button type="button" onclick="wsProcessEventData()">
                    이벤트 데이터 전송
                </button>
            </div>
        </div>
        
        <div class="client">
            <div>
                <h3>클라이언트 수신</h3>
            </div>
            <div>
                <img id="base64Image" />
            </div>
        </div>
    </div>

    <!--<script type="text/javascript" src="./js/bootstrap.js"></script>-->
    <script type="text/javascript" src="./js/main.js"></script>
    <script>
        function wsStatus(value) {
            var innerText = "연결상태 : " + value;
            document.getElementById("wsStatus").innerText = innerText;
        }

        var config = {
            wsAutoConnect: true,
            wsSecure: false,

            wsPort: 33000,
            wssPort: 33001,
        };

        var agent = new WFAAgent(config);
        agent.setWsOnOpenEventHandler(function (e) {
            wsStatus("O");
        });

        agent.setWsOnErrorEventHandler(function (e) {
            window.console.error("setWsOnErrorEventHandler=" + JSON.stringify(e));
        });

        agent.setWsOnMessageEventHandler(function (e) {
            //window.console.info(JSON.stringify(e.data));
        });

        agent.setWsOnCloseEventHandler(function (e) {
            wsStatus("X");
        });

        agent.setProcessStartedEventHandler(function (e) {
            window.console.info(JSON.stringify(e));
        });

        agent.setProcessExitedEventHandler(function (e) {
            window.console.info(JSON.stringify(e));
        });

        agent.setTcpServerListenEventHandler(function (e) {
            window.console.info(JSON.stringify(e));
        });

        agent.setTcpServerAcceptClientEventHandler(function (e) {
            window.console.info(JSON.stringify(e));
        });

        agent.setTcpClientDataReceivedEventHandler(function (e) {
            if (e.appBinaryData != null) {
                var img = document.getElementById("base64Image");
                var extension = e.extension;
                img.src = "data:image/" + e.extension + ";base64," + e.appBinaryData;
            } else {
                window.console.info("Text=" + e.appStringData);
            }
        });

        agent.setTcpClientDisconnectedEventHandler(function (e) {
            window.console.log(JSON.stringify(e));
        });

        function wsConnect() {
            agent.wsConnect();
        }

        function wsProcessStart() {
            var fileName = document.getElementById("wsExecuteFileName").value;
            var data = {
                useCallbackData: true
            };
            agent.wsProcessStart(fileName, data);
        }

        function wsProcessEventData() {
            var eventDataName = document.getElementById("eventDataName").value;
            var data = document.getElementById("eventData").value;
            agent.wsProcessEventData(eventDataName, data);
        }
    </script>
</body>
</html>